<div id="password-container">
  <input id="password-input" type="password" placeholder="輸入密碼以解鎖文章" />
  <button onclick="checkPassword()">解鎖</button>
  <p id="password-message" style="color:red;"></p>
</div>

<pre id="article-content" style="display:none; white-space: pre-wrap;"></pre>

<script>
const slug = "{{ .Page.File.BaseFileName }}";

async function checkPassword() {
  const password = document.getElementById("password-input").value;
  const res = await fetch("https://decrypt-article.ktv8631.workers.dev/api/verify", {
    method: "POST",
    headers: {
      "Content-Type": "application/json"
    },
    body: JSON.stringify({ password, slug })
  });

  if (res.ok) {
    const content = await res.text();
    document.getElementById("password-container").style.display = "none";
    document.getElementById("article-content").textContent = content;
    document.getElementById("article-content").style.display = "block";
  } else {
    const msg = await res.text();
    document.getElementById("password-message").textContent = msg;
  }
}
</script>
